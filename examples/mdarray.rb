require 'env'

require 'scicom'

class Analyse
  
  # data:
  # dimension 0: Month of Jan, Feb, March 
  # dimesnion 1: St1, St2, St3
  # dimension 2: Open, close value
  @data = MDArray.double([22, 4, 6])
  @number_of_days = 22
  @criteria = {:open => 0, :high => 1, :low => 2, :close => 3, :volume => 4, :adj_close => 5}
  @tick = {:google => 0, :microsoft => 1, :yahoo => 2, :apple => 3}

  def self.set_data
    # Google data for Jul. 2014.  Each block represents open, high, low, close, volume,
    # adj close.  Data from yahoo finance.
    @data[0,0,0]=	578.32
    @data[1,0,0]=	583.35
    @data[2,0,0]=	583.35
    @data[3,0,0]=	583.76
    @data[4,0,0]=	577.66
    @data[5,0,0]=	571.58
    @data[6,0,0]=	565.91
    @data[7,0,0]=	571.91
    @data[8,0,0]=	582.60
    @data[9,0,0]=	585.74
    @data[10,0,0]=	588.00
    @data[11,0,0]=	579.53
    @data[12,0,0]=	593.00
    @data[13,0,0]=	591.75
    @data[14,0,0]=	590.72
    @data[15,0,0]=	593.23
    @data[16,0,0]=	596.45
    @data[17,0,0]=	590.40
    @data[18,0,0]=	588.07
    @data[19,0,0]=	588.75
    @data[20,0,0]=	586.55
    @data[21,0,0]=	580.60

    @data[0,0,1]=	584.40
    @data[1,0,1]=	585.44
    @data[2,0,1]=	585.01
    @data[3,0,1]=	586.43
    @data[4,0,1]=	579.53
    @data[5,0,1]=	576.72
    @data[6,0,1]=	576.59
    @data[7,0,1]=	580.85
    @data[8,0,1]=	585.21
    @data[9,0,1]=	585.80
    @data[10,0,1]=	588.40
    @data[11,0,1]=	580.99
    @data[12,0,1]=	596.80
    @data[13,0,1]=	594.40
    @data[14,0,1]=	599.65
    @data[15,0,1]=	597.85
    @data[16,0,1]=	599.50
    @data[17,0,1]=	591.86
    @data[18,0,1]=	592.50
    @data[19,0,1]=	589.70
    @data[20,0,1]=	589.50
    @data[21,0,1]=	583.65

    @data[0,0,2]=	576.65
    @data[1,0,2]=	580.39
    @data[2,0,2]=	580.92
    @data[3,0,2]=	579.59
    @data[4,0,2]=	566.14
    @data[5,0,2]=	569.38
    @data[6,0,2]=	565.01
    @data[7,0,2]=	571.42
    @data[8,0,2]=	578.03
    @data[9,0,2]=	576.56
    @data[10,0,2]=	582.20
    @data[11,0,2]=	568.61
    @data[12,0,2]=	582.00
    @data[13,0,2]=	585.23
    @data[14,0,2]=	590.60
    @data[15,0,2]=	592.50
    @data[16,0,2]=	591.77
    @data[17,0,2]=	587.03
    @data[18,0,2]=	584.75
    @data[19,0,2]=	583.52
    @data[20,0,2]=	584.00
    @data[21,0,2]=	570.00

    @data[0,0,3]=	582.67
    @data[1,0,3]=	582.34
    @data[2,0,3]=	584.73
    @data[3,0,3]=	582.25
    @data[4,0,3]=	571.09
    @data[5,0,3]=	576.08
    @data[6,0,3]=	571.10
    @data[7,0,3]=	579.18
    @data[8,0,3]=	584.87
    @data[9,0,3]=	584.78
    @data[10,0,3]=	582.66
    @data[11,0,3]=	573.73
    @data[12,0,3]=	595.08
    @data[13,0,3]=	589.47
    @data[14,0,3]=	594.74
    @data[15,0,3]=	595.98
    @data[16,0,3]=	593.35
    @data[17,0,3]=	589.02
    @data[18,0,3]=	590.60
    @data[19,0,3]=	585.61
    @data[20,0,3]=	587.42
    @data[21,0,3]=	571.60

    @data[0,0,4]=	1444000
    @data[1,0,4]=	1053500
    @data[2,0,4]=	712200
    @data[3,0,4]=	1061700
    @data[4,0,4]=	1904300
    @data[5,0,4]=	1113700
    @data[6,0,4]=	1353000
    @data[7,0,4]=	1617300
    @data[8,0,4]=	1849000
    @data[9,0,4]=	1618600
    @data[10,0,4]=	1393300
    @data[11,0,4]=	3008300
    @data[12,0,4]=	4003200
    @data[13,0,4]=	2056500
    @data[14,0,4]=	1694500
    @data[15,0,4]=	1229800
    @data[16,0,4]=	1032300
    @data[17,0,4]=	929900
    @data[18,0,4]=	984100
    @data[19,0,4]=	1346200
    @data[20,0,4]=	1013700
    @data[21,0,4]=	2097000

    @data[0,0,5]=	582.67
    @data[1,0,5]=	582.34
    @data[2,0,5]=	584.73
    @data[3,0,5]=	582.25
    @data[4,0,5]=	571.09
    @data[5,0,5]=	576.08
    @data[6,0,5]=	571.10
    @data[7,0,5]=	579.18
    @data[8,0,5]=	584.87
    @data[9,0,5]=	584.78
    @data[10,0,5]=	582.66
    @data[11,0,5]=	573.73
    @data[12,0,5]=	595.08
    @data[13,0,5]=	589.47
    @data[14,0,5]=	594.74
    @data[15,0,5]=	595.98
    @data[16,0,5]=	593.35
    @data[17,0,5]=	589.02
    @data[18,0,5]=	590.60
    @data[19,0,5]=	585.61
    @data[20,0,5]=	587.42
    @data[21,0,5]=	571.60

    # quotes for Microsoft
    @data[0,1,0]=	43.38
    @data[1,1,0]=	44.07
    @data[2,1,0]=	43.91
    @data[3,1,0]=	44.36
    @data[4,1,0]=	44.30
    @data[5,1,0]=	44.93
    @data[6,1,0]=	45.45
    @data[7,1,0]=	45.00
    @data[8,1,0]=	44.56
    @data[9,1,0]=	44.65
    @data[10,1,0]=	45.45
    @data[11,1,0]=	42.51
    @data[12,1,0]=	42.33
    @data[13,1,0]=	42.22
    @data[14,1,0]=	41.70
    @data[15,1,0]=	41.37
    @data[16,1,0]=	41.98
    @data[17,1,0]=	41.87
    @data[18,1,0]=	41.75
    @data[19,1,0]=	41.91
    @data[20,1,0]=	41.73
    @data[21,1,0]=	41.86

    @data[0,1,1]=	43.69
    @data[1,1,1]=	44.10
    @data[2,1,1]=	44.09
    @data[3,1,1]=	44.51
    @data[4,1,1]=	44.66
    @data[5,1,1]=	45.00
    @data[6,1,1]=	45.45
    @data[7,1,1]=	45.15
    @data[8,1,1]=	45.16
    @data[9,1,1]=	44.84
    @data[10,1,1]=	45.71
    @data[11,1,1]=	44.31
    @data[12,1,1]=	42.47
    @data[13,1,1]=	42.45
    @data[14,1,1]=	42.09
    @data[15,1,1]=	42.00
    @data[16,1,1]=	41.99
    @data[17,1,1]=	42.00
    @data[18,1,1]=	42.12
    @data[19,1,1]=	41.99
    @data[20,1,1]=	41.90
    @data[21,1,1]=	42.15

    @data[0,1,2]=	43.08
    @data[1,1,2]=	43.29
    @data[2,1,2]=	43.64
    @data[3,1,2]=	43.93
    @data[4,1,2]=	44.30
    @data[5,1,2]=	44.32
    @data[6,1,2]=	44.62
    @data[7,1,2]=	44.59
    @data[8,1,2]=	44.22
    @data[9,1,2]=	44.25
    @data[10,1,2]=	44.25
    @data[11,1,2]=	42.48
    @data[12,1,2]=	42.03
    @data[13,1,2]=	42.04
    @data[14,1,2]=	41.48
    @data[15,1,2]=	41.05
    @data[16,1,2]=	41.53
    @data[17,1,2]=	41.61
    @data[18,1,2]=	41.71
    @data[19,1,2]=	41.56
    @data[20,1,2]=	41.53
    @data[21,1,2]=	41.69

    @data[0,1,3]=	43.16
    @data[1,1,3]=	43.58
    @data[2,1,3]=	43.89
    @data[3,1,3]=	43.97
    @data[4,1,3]=	44.50
    @data[5,1,3]=	44.40
    @data[6,1,3]=	44.87
    @data[7,1,3]=	44.83
    @data[8,1,3]=	44.84
    @data[9,1,3]=	44.69
    @data[10,1,3]=	44.53
    @data[11,1,3]=	44.08
    @data[12,1,3]=	42.45
    @data[13,1,3]=	42.14
    @data[14,1,3]=	42.09
    @data[15,1,3]=	41.69
    @data[16,1,3]=	41.67
    @data[17,1,3]=	41.78
    @data[18,1,3]=	41.99
    @data[19,1,3]=	41.80
    @data[20,1,3]=	41.90
    @data[21,1,3]=	41.87

    @data[0,1,4]=	31537500
    @data[1,1,4]=	31921400
    @data[2,1,4]=	27763100
    @data[3,1,4]=	29684200
    @data[4,1,4]=	26737700
    @data[5,1,4]=	30725300
    @data[6,1,4]=	52362900
    @data[7,1,4]=	43095800
    @data[8,1,4]=	37604400
    @data[9,1,4]=	43407500
    @data[10,1,4]=	82180300
    @data[11,1,4]=	63318000
    @data[12,1,4]=	28748700
    @data[13,1,4]=	21881100
    @data[14,1,4]=	24083000
    @data[15,1,4]=	21854700
    @data[16,1,4]=	18445900
    @data[17,1,4]=	31218200
    @data[18,1,4]=	21952400
    @data[19,1,4]=	15969300
    @data[20,1,4]=	20208100
    @data[21,1,4]=	26917000

    @data[0,1,5]=	42.62
    @data[1,1,5]=	43.04
    @data[2,1,5]=	43.34
    @data[3,1,5]=	43.42
    @data[4,1,5]=	43.95
    @data[5,1,5]=	43.85
    @data[6,1,5]=	44.31
    @data[7,1,5]=	44.27
    @data[8,1,5]=	44.28
    @data[9,1,5]=	44.13
    @data[10,1,5]=	43.98
    @data[11,1,5]=	43.53
    @data[12,1,5]=	41.92
    @data[13,1,5]=	41.62
    @data[14,1,5]=	41.57
    @data[15,1,5]=	41.17
    @data[16,1,5]=	41.15
    @data[17,1,5]=	41.26
    @data[18,1,5]=	41.47
    @data[19,1,5]=	41.28
    @data[20,1,5]=	41.38
    @data[21,1,5]=	41.35

    # yahoo quotes
    @data[0,2,0]=	36.26
    @data[1,2,0]=	35.94
    @data[2,2,0]=	35.91
    @data[3,2,0]=	36.23
    @data[4,2,0]=	36.00
    @data[5,2,0]=	35.09
    @data[6,2,0]=	33.78
    @data[7,2,0]=	33.48
    @data[8,2,0]=	33.35
    @data[9,2,0]=	33.18
    @data[10,2,0]=	33.82
    @data[11,2,0]=	34.42
    @data[12,2,0]=	35.72
    @data[13,2,0]=	35.80
    @data[14,2,0]=	34.95
    @data[15,2,0]=	34.33
    @data[16,2,0]=	34.68
    @data[17,2,0]=	35.64
    @data[18,2,0]=	36.15
    @data[19,2,0]=	36.07
    @data[20,2,0]=	35.62
    @data[21,2,0]=	35.50

    @data[0,2,1]=	36.49
    @data[1,2,1]=	36.99
    @data[2,2,1]=	36.16
    @data[3,2,1]=	36.23
    @data[4,2,1]=	36.33
    @data[5,2,1]=	36.55
    @data[6,2,1]=	34.92
    @data[7,2,1]=	33.84
    @data[8,2,1]=	33.64
    @data[9,2,1]=	33.35
    @data[10,2,1]=	33.90
    @data[11,2,1]=	34.45
    @data[12,2,1]=	35.94
    @data[13,2,1]=	35.95
    @data[14,2,1]=	35.56
    @data[15,2,1]=	34.97
    @data[16,2,1]=	35.07
    @data[17,2,1]=	35.66
    @data[18,2,1]=	36.23
    @data[19,2,1]=	36.15
    @data[20,2,1]=	35.91
    @data[21,2,1]=	35.70

    @data[0,2,2]=	35.68
    @data[1,2,2]=	35.80
    @data[2,2,2]=	35.67
    @data[3,2,2]=	35.51
    @data[4,2,2]=	35.75
    @data[5,2,2]=	35.04
    @data[6,2,2]=	33.68
    @data[7,2,2]=	33.40
    @data[8,2,2]=	33.16
    @data[9,2,2]=	32.93
    @data[10,2,2]=	32.98
    @data[11,2,2]=	33.72
    @data[12,2,2]=	35.20
    @data[13,2,2]=	35.45
    @data[14,2,2]=	34.78
    @data[15,2,2]=	34.10
    @data[16,2,2]=	34.68
    @data[17,2,2]=	34.28
    @data[18,2,2]=	35.48
    @data[19,2,2]=	35.90
    @data[20,2,2]=	35.40
    @data[21,2,2]=	35.21

    @data[0,2,3]=	35.81
    @data[1,2,3]=	36.60
    @data[2,2,3]=	35.68
    @data[3,2,3]=	35.90
    @data[4,2,3]=	36.12
    @data[5,2,3]=	36.17
    @data[6,2,3]=	34.71
    @data[7,2,3]=	33.60
    @data[8,2,3]=	33.28
    @data[9,2,3]=	33.33
    @data[10,2,3]=	33.21
    @data[11,2,3]=	33.79
    @data[12,2,3]=	35.61
    @data[13,2,3]=	35.70
    @data[14,2,3]=	35.43
    @data[15,2,3]=	34.93
    @data[16,2,3]=	34.85
    @data[17,2,3]=	34.53
    @data[18,2,3]=	35.52
    @data[19,2,3]=	36.14
    @data[20,2,3]=	35.88
    @data[21,2,3]=	35.35

    @data[0,2,4]=	17937400
    @data[1,2,4]=	29876700
    @data[2,2,4]=	11570900
    @data[3,2,4]=	14607200
    @data[4,2,4]=	20143800
    @data[5,2,4]=	47391000
    @data[6,2,4]=	38622500
    @data[7,2,4]=	18153600
    @data[8,2,4]=	18431000
    @data[9,2,4]=	21540900
    @data[10,2,4]=	37535900
    @data[11,2,4]=	56260600
    @data[12,2,4]=	36316600
    @data[13,2,4]=	18680500
    @data[14,2,4]=	18379500
    @data[15,2,4]=	18064800
    @data[16,2,4]=	12626900
    @data[17,2,4]=	23096900
    @data[18,2,4]=	15716800
    @data[19,2,4]=	8604900
    @data[20,2,4]=	16533600
    @data[21,2,4]=	18609600

    @data[0,2,5]=	35.81
    @data[1,2,5]=	36.60
    @data[2,2,5]=	35.68
    @data[3,2,5]=	35.90
    @data[4,2,5]=	36.12
    @data[5,2,5]=	36.17
    @data[6,2,5]=	34.71
    @data[7,2,5]=	33.60
    @data[8,2,5]=	33.28
    @data[9,2,5]=	33.33
    @data[10,2,5]=	33.21
    @data[11,2,5]=	33.79
    @data[12,2,5]=	35.61
    @data[13,2,5]=	35.70
    @data[14,2,5]=	35.43
    @data[15,2,5]=	34.93
    @data[16,2,5]=	34.85
    @data[17,2,5]=	34.53
    @data[18,2,5]=	35.52
    @data[19,2,5]=	36.14
    @data[20,2,5]=	35.88
    @data[21,2,5]=	35.35

    # Apple quotes
    @data[0,3,0]=	97.16
    @data[1,3,0]=	98.44
    @data[2,3,0]=	99.33
    @data[3,3,0]=	97.82
    @data[4,3,0]=	96.85
    @data[5,3,0]=	97.04
    @data[6,3,0]=	95.42
    @data[7,3,0]=	94.68
    @data[8,3,0]=	94.99
    @data[9,3,0]=	93.62
    @data[10,3,0]=	95.03
    @data[11,3,0]=	96.97
    @data[12,3,0]=	96.80
    @data[13,3,0]=	95.86
    @data[14,3,0]=	95.36
    @data[15,3,0]=	93.76
    @data[16,3,0]=	95.44
    @data[17,3,0]=	96.27
    @data[18,3,0]=	94.14
    @data[19,3,0]=	93.67
    @data[20,3,0]=	93.87
    @data[21,3,0]=	93.52

    @data[0,3,1]=	97.45
    @data[1,3,1]=	98.70
    @data[2,3,1]=	99.44
    @data[3,3,1]=	99.24
    @data[4,3,1]=	97.84
    @data[5,3,1]=	97.32
    @data[6,3,1]=	97.88
    @data[7,3,1]=	94.89
    @data[8,3,1]=	95.00
    @data[9,3,1]=	94.74
    @data[10,3,1]=	95.28
    @data[11,3,1]=	97.10
    @data[12,3,1]=	96.85
    @data[13,3,1]=	96.89
    @data[14,3,1]=	95.89
    @data[15,3,1]=	95.55
    @data[16,3,1]=	95.95
    @data[17,3,1]=	96.80
    @data[18,3,1]=	95.99
    @data[19,3,1]=	94.10
    @data[20,3,1]=	94.06
    @data[21,3,1]=	94.07

    @data[0,3,2]=	95.33
    @data[1,3,2]=	97.67
    @data[2,3,2]=	98.25
    @data[3,3,2]=	97.55
    @data[4,3,2]=	96.64
    @data[5,3,2]=	96.42
    @data[6,3,2]=	95.17
    @data[7,3,2]=	94.12
    @data[8,3,2]=	93.72
    @data[9,3,2]=	93.02
    @data[10,3,2]=	92.57
    @data[11,3,2]=	94.74
    @data[12,3,2]=	95.03
    @data[13,3,2]=	95.65
    @data[14,3,2]=	94.86
    @data[15,3,2]=	93.52
    @data[16,3,2]=	94.76
    @data[17,3,2]=	93.92
    @data[18,3,2]=	94.10
    @data[19,3,2]=	93.20
    @data[20,3,2]=	93.09
    @data[21,3,2]=	93.13

    @data[0,3,3]=	95.60
    @data[1,3,3]=	98.15
    @data[2,3,3]=	98.38
    @data[3,3,3]=	99.02
    @data[4,3,3]=	97.67
    @data[5,3,3]=	97.03
    @data[6,3,3]=	97.19
    @data[7,3,3]=	94.72
    @data[8,3,3]=	93.94
    @data[9,3,3]=	94.43
    @data[10,3,3]=	93.09
    @data[11,3,3]=	94.78
    @data[12,3,3]=	95.32
    @data[13,3,3]=	96.45
    @data[14,3,3]=	95.22
    @data[15,3,3]=	95.04
    @data[16,3,3]=	95.39
    @data[17,3,3]=	95.35
    @data[18,3,3]=	95.97
    @data[19,3,3]=	94.03
    @data[20,3,3]=	93.48
    @data[21,3,3]=	93.52

    @data[0,3,4]=	56843000
    @data[1,3,4]=	33010000
    @data[2,3,4]=	43143000
    @data[3,3,4]=	55318000
    @data[4,3,4]=	43469000
    @data[5,3,4]=	45729000
    @data[6,3,4]=	92918000
    @data[7,3,4]=	55197000
    @data[8,3,4]=	39079000
    @data[9,3,4]=	49988000
    @data[10,3,4]=	57298000
    @data[11,3,4]=	53502000
    @data[12,3,4]=	45477900
    @data[13,3,4]=	42810000
    @data[14,3,4]=	34018000
    @data[15,3,4]=	39686000
    @data[16,3,4]=	36436000
    @data[17,3,4]=	65222000
    @data[18,3,4]=	56468000
    @data[19,3,4]=	22891800
    @data[20,3,4]=	28465000
    @data[21,3,4]=	38223000

    @data[0,3,5]=	94.72
    @data[1,3,5]=	97.24
    @data[2,3,5]=	97.47
    @data[3,3,5]=	98.10
    @data[4,3,5]=	96.77
    @data[5,3,5]=	96.13
    @data[6,3,5]=	96.29
    @data[7,3,5]=	93.84
    @data[8,3,5]=	93.07
    @data[9,3,5]=	93.56
    @data[10,3,5]=	92.23
    @data[11,3,5]=	93.90
    @data[12,3,5]=	94.44
    @data[13,3,5]=	95.56
    @data[14,3,5]=	94.34
    @data[15,3,5]=	94.16
    @data[16,3,5]=	94.51
    @data[17,3,5]=	94.47
    @data[18,3,5]=	95.08
    @data[19,3,5]=	93.16
    @data[20,3,5]=	92.62
    @data[21,3,5]=	92.66

  end


  def self.stock_stats(stock, criterion)

    # Each section is selecting a given stock for the whole period of 22 days.  We then call 
    # R.summary on the given section to get the basic statistics for each stock.
    sec = @data.section([0,  stock, criterion], [22, 1, 1], true)
    R.summary(R.md(sec)).pp

  end

  set_data
  p "Google statistics for opening price"
  stock_stats(@tick[:google], @criteria[:open])
  p "Google statistics for volume"
  stock_stats(@tick[:google], @criteria[:volume])
  p "Apple statistics for closing price"
  stock_stats(@tick[:apple], @criteria[:close])

  # Summary statistics for volume of all 4 stocks
  sec = @data.section([0,  0, @criteria[:volume]], [22, 4, 1], true)
  R.summary(R.md(sec)).pp

end

